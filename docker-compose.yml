services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    # Changed image name to avoid conflict with older project
    image: compliance-os-v2:latest
    # Changed container name for isolation
    container_name: compliance-os-v2-web
    restart: unless-stopped
    ports:
      # Map host port 3001 to container port 3000 to avoid conflicts with other apps (like 8080)
      - "3001:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/data/prod.db # Direct SQLite to the mounted volume
      # ZHIPU_API_KEY MUST be provided via .env file or GitHub Secrets during deployment
      - ZHIPU_API_KEY=${ZHIPU_API_KEY} 
    volumes:
      # Mount the local ./data directory to the container's /app/data
      # This ensures SQLite database persists across container restarts and updates
      - ./data:/app/data
